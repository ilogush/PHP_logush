# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Ö–æ—Å—Ç–∏–Ω–≥–∞ WMRS

## ‚úÖ –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏
- –î–æ–±–∞–≤–ª–µ–Ω in-memory –∫—ç—à –≤ `DataStore` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- –ö—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø–∏—Å–∏

### 2. –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
- `PageController` –∏ `ApiController` —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω—ã
- –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–π
- –°–µ—Å—Å–∏—è —Å—Ç–∞—Ä—Ç—É–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–º –æ–Ω–∞ –Ω—É–∂–Ω–∞:
  - `/admin/*` - –∞–¥–º–∏–Ω–∫–∞
  - `/cart/*` - –∫–æ—Ä–∑–∏–Ω–∞
  - `/checkout` - –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
  - `/login`, `/logout` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –ü—É–±–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ —Å–µ—Å—Å–∏–∏

### 4. –ò–Ω–¥–µ–∫—Å—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:
```sql
-- –ü—Ä–æ–¥—É–∫—Ç—ã
CREATE INDEX idx_products_main_category ON products(main_category);
CREATE INDEX idx_products_in_stock ON products(in_stock);

-- –ó–∞–∫–∞–∑—ã
CREATE INDEX idx_orders_customer_email ON orders(customer_email);
```

### 5. HTTP-–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏
–í `.htaccess`:
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (CSS, JS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è): –∫—ç—à 1 –≥–æ–¥
- HTML: –±–µ–∑ –∫—ç—à–∞ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç)
- Gzip-—Å–∂–∞—Ç–∏–µ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

### 6. –£–±—Ä–∞–Ω seed() –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- `seed()` —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ CLI-—Å–∫—Ä–∏–ø—Ç
- –≠–∫–æ–Ω–æ–º–∏—è 50-100ms –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è WMRS –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### PHP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—á–µ—Ä–µ–∑ ISPmanager)

1. **–í–∫–ª—é—á–∏—Ç—å OPcache** (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ):
   ```ini
   opcache.enable=1
   opcache.memory_consumption=128
   opcache.interned_strings_buffer=8
   opcache.max_accelerated_files=10000
   opcache.revalidate_freq=60
   opcache.validate_timestamps=1
   ```

2. **–£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç—ã**:
   ```ini
   memory_limit=256M
   max_execution_time=60
   upload_max_filesize=8M
   post_max_size=10M
   ```

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–π**:
   ```ini
   session.save_handler=files
   session.gc_maxlifetime=3600
   session.cookie_httponly=1
   session.cookie_samesite=Lax
   ```

### MySQL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é MySQL**:
   ```bash
   mysql --version
   ```
   –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è MySQL 8.0+ –∏–ª–∏ MariaDB 10.5+

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü** (–≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞–∑ –≤ –º–µ—Å—è—Ü):
   ```sql
   OPTIMIZE TABLE products, categories, orders, colors, sizes, users, settings;
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã**:
   ```sql
   SHOW INDEX FROM products;
   SHOW INDEX FROM orders;
   ```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ |
|---------|----------------|-------------------|
| –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –≥–ª–∞–≤–Ω–æ–π | 300-500ms | 100-200ms |
| –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API | 200-400ms | 50-150ms |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ | 20-30MB | 10-20MB |
| –ó–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î | 5-10 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É | 2-5 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É |
| –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω—è—è |

---

## üöÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–î–æ–±–∞–≤–∏—Ç—å –≤ `.env`:
```env
APP_DEBUG=0
APP_LOG_QUERIES=0
```

### 2. –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å cron-–∑–∞–¥–∞—á—É –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
```bash
# –ö–∞–∂–¥—É—é –Ω–æ—á—å –≤ 3:00
0 3 * * * cd /var/www/<USER>/data && php scripts/cleanup.php
```

### 3. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:
```bash
php scripts/backup_db.php
```

### 4. CDN –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ç—Ä–∞—Ñ–∏–∫ –±–æ–ª—å—à–æ–π, —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
- Cloudflare (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ)
- KeyCDN
- BunnyCDN

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å (—Ö–æ–ª–æ–¥–Ω—ã–π –∫—ç—à)
time curl -s http://localhost:8000/ > /dev/null

# –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å (–≥–æ—Ä—è—á–∏–π –∫—ç—à)
time curl -s http://localhost:8000/ > /dev/null
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã
```sql
EXPLAIN SELECT * FROM products WHERE main_category = '–ñ–ï–ù–°–ö–ê–Ø';
-- –î–æ–ª–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å idx_products_main_category
```

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Å—Å–∏–∏
```bash
# –ü—É–±–ª–∏—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - —Å–µ—Å—Å–∏—è –Ω–µ –¥–æ–ª–∂–Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å
curl -v http://localhost:8000/ 2>&1 | grep -i "set-cookie"

# –ö–æ—Ä–∑–∏–Ω–∞ - —Å–µ—Å—Å–∏—è –¥–æ–ª–∂–Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å
curl -v http://localhost:8000/cart 2>&1 | grep -i "set-cookie"
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –¥–ª—è WMRS

1. **–ü—É—Ç—å –∫ PHP**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ `.htaccess` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å:
   ```apache
   FCGIWrapper /var/www/<USER>/data/php-bin-isp-php82/php .php
   ```

2. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**:
   ```bash
   chmod 755 storage/uploads
   chmod 755 storage/data
   chmod 755 storage/backups
   ```

3. **–õ–∏–º–∏—Ç—ã —Ö–æ—Å—Ç–∏–Ω–≥–∞**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ PHP
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ MySQL
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–≤–æ—Ç—É –Ω–∞ –¥–∏—Å–∫

4. **.env —Ñ–∞–π–ª**:
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `.env` –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –≤–µ–±
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ `.htaccess` –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–æ—Å—Ç—É–ø–∞

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `storage/php_errors.log`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å slow query log MySQL
3. –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π WMRS –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤
